# 2026-02-24 Triage Log

Overall, a bit more noise than usual this week, but mostly a slight improvement
with several low-level optimizations at MIR and LLVM IR building landing. Also
less commits landing than usual, mostly due to GitHub CI issues during the week.

Triage done by **@simulacrum**.
Revision range: [3c9faa0d..eeb94be7](https://perf.rust-lang.org/?start=3c9faa0d037b9eecda4a440cc482ff7f960fb8a5&end=eeb94be79adc9df7a09ad0b2421f16e60e6d932c&absolute=false&stat=instructions%3Au)

**Summary**:

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.4%  | [0.2%, 0.8%]   | 4     |
| Regressions ❌ <br /> (secondary)  | 0.3%  | [0.1%, 0.8%]   | 14    |
| Improvements ✅ <br /> (primary)   | -0.4% | [-2.2%, -0.2%] | 67    |
| Improvements ✅ <br /> (secondary) | -0.8% | [-5.0%, -0.1%] | 54    |
| All ❌✅ (primary)                 | -0.4% | [-2.2%, 0.8%]  | 71    |

3 Regressions, 4 Improvements, 4 Mixed; 3 of them in rollups
24 artifact comparisons made in total

#### Regressions

Perform many const checks in typeck [#149375](https://github.com/rust-lang/rust/pull/149375) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=b6bed6f2d9f27e15d425958bbd288138ecdff61c&end=7f99507f57e6c4aa0dce3daf6a13cca8cd4dd312&stat=instructions:u)

| (instructions:u)                   | mean | range        | count |
|:----------------------------------:|:----:|:------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.2% | [0.2%, 0.2%] | 3     |
| Regressions ❌ <br /> (secondary)  | 0.2% | [0.2%, 0.2%] | 4     |
| Improvements ✅ <br /> (primary)   | -    | -            | 0     |
| Improvements ✅ <br /> (secondary) | -    | -            | 0     |
| All ❌✅ (primary)                 | 0.2% | [0.2%, 0.2%] | 3     |

Most likely expected impact from running more code. Impact is small, and
possibly limited to only secondary benchmarks: primary benchmark impact to libc
*might* be noise, though it's hard to tell.

Rollup of 14 pull requests [#152965](https://github.com/rust-lang/rust/pull/152965) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=d8b2222b11fc03a31d43707c8c9006f025809ece&end=1500f0f47f5fe8ddcd6528f6c6c031b210b4eac5&stat=instructions:u)

| (instructions:u)                   | mean | range        | count |
|:----------------------------------:|:----:|:------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.4% | [0.2%, 0.8%] | 10    |
| Regressions ❌ <br /> (secondary)  | 0.8% | [0.8%, 0.8%] | 1     |
| Improvements ✅ <br /> (primary)   | -    | -            | 0     |
| Improvements ✅ <br /> (secondary) | -    | -            | 0     |
| All ❌✅ (primary)                 | 0.4% | [0.2%, 0.8%] | 10    |

Still tracking down full set of root causes, but seems likely that at least the
doc impact was due to changes in ByteStr (probably because rustdoc displays a
lot of `Path`s which use ByteStr under the hood?). Some of the other impact has
unclear origin at this point.

Remove `const FLAGS`. [#152791](https://github.com/rust-lang/rust/pull/152791) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=eeb94be79adc9df7a09ad0b2421f16e60e6d932c&end=b3869b94cd1ed4bfa2eb28f301535d5e9599c713&stat=instructions:u)

| (instructions:u)                   | mean | range        | count |
|:----------------------------------:|:----:|:------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.2% | [0.1%, 0.5%] | 17    |
| Regressions ❌ <br /> (secondary)  | 0.3% | [0.1%, 0.6%] | 37    |
| Improvements ✅ <br /> (primary)   | -    | -            | 0     |
| Improvements ✅ <br /> (secondary) | -    | -            | 0     |
| All ❌✅ (primary)                 | 0.2% | [0.1%, 0.5%] | 17    |

Expected regressions in several benchmarks, simplifying code judged more
important here than the slight perf loss.

#### Improvements

Simplify the canonical enum clone branches to a copy statement [#148034](https://github.com/rust-lang/rust/pull/148034) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=fbd6934114e905d3cc61adbbd7e4a355eac5d0d7&end=41198cb9659f3cc7c4a1a3ee97bc4af78bee403e&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.7%  | [0.7%, 0.7%]   | 1     |
| Regressions ❌ <br /> (secondary)  | 0.2%  | [0.2%, 0.2%]   | 1     |
| Improvements ✅ <br /> (primary)   | -0.6% | [-2.1%, -0.2%] | 9     |
| Improvements ✅ <br /> (secondary) | -0.5% | [-0.8%, -0.2%] | 14    |
| All ❌✅ (primary)                 | -0.5% | [-2.1%, 0.7%]  | 10    |

Two regressions look like noise. Nice win!

Rollup of 6 pull requests [#152934](https://github.com/rust-lang/rust/pull/152934) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=99246f40931ce1d1d29517b61bd70dd9ed4fbe5d&end=5fb2ff8611e5a4af4dc85977cfdecfbf3ffa6ade&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -              | 0     |
| Regressions ❌ <br /> (secondary)  | -     | -              | 0     |
| Improvements ✅ <br /> (primary)   | -0.5% | [-0.5%, -0.5%] | 2     |
| Improvements ✅ <br /> (secondary) | -0.4% | [-0.6%, -0.2%] | 3     |
| All ❌✅ (primary)                 | -0.5% | [-0.5%, -0.5%] | 2     |

Changes look maybe slightly above noise threshold but not by much. Possibly
just noise, possibly due to giving LLVM more information in "Tighten the !range
bounds on alignments in vtables" [#152929](https://github.com/rust-lang/rust/pull/152929).

Rollup of 18 pull requests [#152825](https://github.com/rust-lang/rust/pull/152825) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=e0cb264b814526acb82def4b5810e394a2ed294f&end=fbd6934114e905d3cc61adbbd7e4a355eac5d0d7&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -              | 0     |
| Regressions ❌ <br /> (secondary)  | 0.2%  | [0.2%, 0.2%]   | 1     |
| Improvements ✅ <br /> (primary)   | -0.2% | [-0.3%, -0.2%] | 5     |
| Improvements ✅ <br /> (secondary) | -0.3% | [-0.6%, -0.1%] | 5     |
| All ❌✅ (primary)                 | -0.2% | [-0.3%, -0.2%] | 5     |

The one regression looks like noise, so moved to improvements in this report.
The rollup is large enough that the source of those improvements is hard to
narrow down.

Bring back `enum DepKind`. [#152747](https://github.com/rust-lang/rust/pull/152747) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=ef70767064ab87b0a41400f69e1dc0b55c8d5284&end=59fd4ef94daa991e6797b5aa6127e824f3067def&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -              | 0     |
| Regressions ❌ <br /> (secondary)  | 0.8%  | [0.8%, 0.8%]   | 1     |
| Improvements ✅ <br /> (primary)   | -0.3% | [-0.7%, -0.2%] | 34    |
| Improvements ✅ <br /> (secondary) | -0.3% | [-0.7%, -0.1%] | 10    |
| All ❌✅ (primary)                 | -0.3% | [-0.7%, -0.2%] | 34    |

One regression is noise. Moving to improvements.

#### Mixed

Revert "Fix an ICE in the vtable iteration for a trait reference" [#152738](https://github.com/rust-lang/rust/pull/152738) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=1210e9fa3ee9c9712fa694f90f7a032f2f0fd786&end=3f6250a7bb79e600d9036bbc7c8f65af43933643&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | -     | -              | 0     |
| Regressions ❌ <br /> (secondary)  | 0.2%  | [0.2%, 0.3%]   | 4     |
| Improvements ✅ <br /> (primary)   | -     | -              | 0     |
| Improvements ✅ <br /> (secondary) | -0.9% | [-1.3%, -0.5%] | 16    |
| All ❌✅ (primary)                 | -     | -              | 0     |

Already triaged in advance (https://github.com/rust-lang/rust/pull/152738#issuecomment-3915321344):

> Revert of #152287 which landed in the rollup #152399 and should have seen the opposite effect.

No further action needed.

Audit Symbols [#152624](https://github.com/rust-lang/rust/pull/152624) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=1c00e989ca032d57e815e930fad00b61e65a1826&end=3fc37321c49cb8aed32da426de6145e6d57105da&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.2%  | [0.2%, 0.2%]   | 1     |
| Regressions ❌ <br /> (secondary)  | 0.2%  | [0.1%, 0.2%]   | 2     |
| Improvements ✅ <br /> (primary)   | -     | -              | 0     |
| Improvements ✅ <br /> (secondary) | -0.5% | [-0.7%, -0.3%] | 4     |
| All ❌✅ (primary)                 | 0.2%  | [0.2%, 0.2%]   | 1     |

Perf regressions look close to noise thresholds (though maybe not entirely
noise). Regardless I don't think it's worth trying to iterate on the specific
set of symbols too much, it's effectively neutral (mean including non-relevant
is +0.01% on instructions, +0.00% on cycles).

Just pass `Layout` directly to `box_new_uninit` [#152737](https://github.com/rust-lang/rust/pull/152737) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=5fb2ff8611e5a4af4dc85977cfdecfbf3ffa6ade&end=d8b2222b11fc03a31d43707c8c9006f025809ece&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 1.3%  | [1.3%, 1.3%]   | 1     |
| Regressions ❌ <br /> (secondary)  | 0.7%  | [0.5%, 0.8%]   | 6     |
| Improvements ✅ <br /> (primary)   | -0.8% | [-1.1%, -0.5%] | 7     |
| Improvements ✅ <br /> (secondary) | -1.8% | [-3.8%, -0.4%] | 9     |
| All ❌✅ (primary)                 | -0.5% | [-1.1%, 1.3%]  | 8     |

Some nice wins, a few regressions. Overall seems like a positive change. See
also the note in the PR
(https://github.com/rust-lang/rust/pull/152737#issuecomment-3941795762).

GVN: consider constants of primitive types as deterministic [#149366](https://github.com/rust-lang/rust/pull/149366) [(Comparison Link)](https://perf.rust-lang.org/compare.html?start=d3e8bd94cc042c65e30a6c60146a8a00531d1292&end=eeb94be79adc9df7a09ad0b2421f16e60e6d932c&stat=instructions:u)

| (instructions:u)                   | mean  | range          | count |
|:----------------------------------:|:-----:|:--------------:|:-----:|
| Regressions ❌ <br /> (primary)    | 0.7%  | [0.6%, 0.8%]   | 3     |
| Regressions ❌ <br /> (secondary)  | -     | -              | 0     |
| Improvements ✅ <br /> (primary)   | -0.3% | [-0.7%, -0.2%] | 15    |
| Improvements ✅ <br /> (secondary) | -0.3% | [-0.3%, -0.3%] | 1     |
| All ❌✅ (primary)                 | -0.1% | [-0.7%, 0.8%]  | 18    |

Some nice wins on a number of benchmarks. The regressions look potentially real
but are generally outweighed by the improvements.
